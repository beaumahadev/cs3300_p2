<html>
<head>
<title>Defense Budgets Worldwide</title>
<link href="https://fonts.googleapis.com/css?family=Merriweather" rel="stylesheet">
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/styles/default.min.css">
<script src="https://d3js.org/d3.v4.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/highlight.min.js"></script>
<style>
body { font-family: 'Merriweather', Calibri, sans-serif; }



div.donut{ 
  display:block;
  width: 1000px;
  height: 1000px;
  justify-content: left;
 }
div.infobox{
  width:200px;
  height: 550px;
  background: #624c84;
  display: inline-block;
  vertical-align: top;
  position: absolute;  
  top: 550px; 
  left: 1050px;
  border: 1px solid white;
  padding: 10px;
}
svg#svglinegraph {
  width: 960px;
  height: 550px;
 display:block;
 justify-content: left;
}
div#sidebar {
  display: inline-block;
  width:200px;
  height: 100px;
  vertical-align: top; 
  position: absolute;
  top: 1500px;
  left: 1050px;
}

div #option {
  margin-bottom: 10px;
}
div .tooltip {
  width: 60px;
  height: 30px;
  padding: 2px;
  border-radius: 5px;
  border: 0px;
  position: absolute;
  text-align: center;
  background: lightsteelblue;
}
body{
  background-color:#25183a;
}
p{
  color: white;
  font: 15px sans-serif;
  
}

b{
  font: 20px sans-serif;
  color: #ce5ca4;


}

h1{
  font: 30px sans-serif;
  color: #ce5ca4;
  text-align: center;
}
h2{
  color: #ce5ca4;
}

div.title {
    margin: auto;
    width:900px;
    height:150px;
    border: 3px solid #ce5ca4;
    justify-content: center;
    text-align: center; 
}

div.blurb {
  margin: 15px;
  padding: 15px;
  border: 1px dotted #ce5ca4;
  display: inline-block;
  vertical-align: top;
}

svg#horizontalChart {
  width: 800px;
  height: 450px;
  display:block;
  justify-content: left;
}


.blurb h2{
  font: 25px sans-serif;

}

.infobox h1{
  font: 20px sans-serif;
}

.infobox h2{
  font: 15px sans-serif;
  color: white;
  text-align: center;
}
.infobox p{
  font: 10px sans-serif;
  color: white;

}

.axis line{
  stroke: white;
}

.axis path{
  stroke: white;
}

.axis text{
  fill: white;
}


</style>
</head>
<body>

<div class="Title">
<h1>
Defense Budget Allocation by International Governments 
</h1>
<p>
<i>
Understanding the vast amounts of money spent by the U.S. government and other European countries on military operations and exploring their roles in the destabilization of other countries. 
</i>
</p>
</div>

<div class="Blurb">
<p>
The US Department of Defense has (as of 2010 inventory):
</p>
<h2>4,999 military facilities</h2>
<p>
<b> 4,249 </b>  are in the United States
</p>
<p>
<b>88 </b> are in overseas US territories
</p>
<p>
<b>662</b> are in foreign countries and foreign territories
</p>
<p>
They cost <b>$900 billion </b> per year or <b>5 percent</b> of US national income
</p>
</div>

<div class= "Blurb">
<p>
 Since <b>2001</b>, acknowledged U.S. national defense spending </br> has increased by almost <b>60 percent</b>
</p>
<p>
Between <b>1898 </b> and <b>1994</b>, the U.S. on average overthrew</br> <b> one latin american government every 28 months </b> <br>not including failed attempts, such as the Bay of Pigs invasion of Cuba.
</p>
</div>



<div  class= "donut" id="donut"></div>

<div class= "infobox" id="infobox">
 <h1>
 War Info:
 </h1> 
 <h2 id="name"></h2>
 <p id="description"></p>
 <div id="countrylist"></div>
</div>

<div class="linegraph">
  <h1>Overall Spending Over Time:</h1>
  <svg id="svglinegraph"></svg>
  <div id="sidebar">
    <p>By far, US spends more than any other country on their military. If US was removed from this graph, the distribution of spending among other countries can be more clearly seen.</p>
    <div id="option">
    <input name="resetButton" 
           type="button" 
           value="Reset" 
           onclick="reset()" />
    </div>
    <div id="option">
    <input name="updateButton" 
           type="button" 
           value="Remove US" 
           onclick="removeUS()" />
    </div>
    <p>Filter by Region:</p>
    <div id="option">
    <input name="resetButton" 
           type="button" 
           value="Africa" 
           onclick="filter(value)" />
    </div>
    <div id="option">
    <input name="resetButton" 
           type="button" 
           value="Americas" 
           onclick="filter(value)" />
    </div>
    <div id="option">
    <input name="resetButton" 
           type="button" 
           value="Europe" 
           onclick="filter(value)" />
    </div>
    <div id="option">
    <input name="resetButton" 
           type="button" 
           value="Oceania" 
           onclick="filter(value)" />
    </div>
    <div id="option">
    <input name="resetButton" 
           type="button" 
           value="Middle East" 
           onclick="filter(value)" />
    </div>
    <div id="option">
    <input name="resetButton" 
           type="button" 
           value="Asia" 
           onclick="filter(value)" />
    </div>
  </div>
</div>

<div>
  <h1>Top 5 Total Spending:</h1>
  <svg id="horizontalchart"></svg>
  <div id="option"></div>
</div>

<script>

var widthScatter=250;
var heightScatter=250;
var minProfit=1000;
var maxProfit=1000000;
var height = 1000;
var width = 1000;

var warDataReal = [];
var spendingData = [];
var minSpending = 100000000;
var maxSpending = 0;
var maxCountry = "";
var maxTotal = 0;
var counter = -1;
//removed Ukraine, Yemen, Israel, Kuwait, Japan, 
const countrySet = new Set(["Angola","Burundi", "Congo","Djibouti", "Rwanda","Uganda","SouthAfrica","Sudan", "UnitedStates","Canada","Mexico","Brazil", "China", "Philippines", "SouthKorea","Pakistan", "Afghanistan", "India", "Australia","Iran","Iraq", "Kuwait", "Israel", "Oman", "UAE", "Yemen", "SaudiArabia", "Qatar", "Turkey", "Georgia", "Russia", "France", "Germany", "Ukraine", "Italy", "UK", "Spain", "Romania", "Albania"]);

var innerColorScale = d3.scaleOrdinal()
    .range(["#468B81","#B9D46E","#E3CE6B","#DE6D51","#C5424E","#B9D46E","#E3CE6B","#DE6D51"])
    .domain([0, countrySet.length]);

var colorToCountry = new Map([["Africa", "#468B81"], ["Americas", "#B9D46E"], ["Asia", "#E3CE6B"], ["Oceania", "#DE6D51"], ["Middle East", "#C5424E"], ["Europe", "#61B7FC"]]);



var mainSVG = d3.select("#donut").append('svg')
.attr("height", height).attr("width", width)
.style("height", height)
.style("width", width);

d3.queue()
        .defer(d3.csv, "wars_final.csv")
        .await(callback)
        function callback (error, data) {
          data.forEach(function(d) {
            d.name = d["Name of Conflict"];
            if (d.Finish === "Ongoing") {
              d.Finish = 2016;
            }
            d.duration = d.Finish - d.Start + 1;
            d.countries = [];
            //d.companies = getCompanies(companySize);
            var countryData = d["Belligerents"].split(",");
            for (var i = 0; i < countryData.length; i++) {
              var str = countryData[i].replace(/\s+/g, '');
              if (countrySet.has(str)) {
                d.countries.push(str);
              }
            }
            var countryData2 = d["Countries"].split(",");
            for (var i = 0; i < countryData2.length; i++) {
              var str = countryData2[i].replace(/\s+/g, '');
              if (countrySet.has(str) && !d.countries.includes(str)) {
                d.countries.push(str);
              }
            }
            d.id = counter;
            d.desc = d["Description"];
            counter++;
            warDataReal.push(d);
            //warDataReal[d["Name of Conflict"]] = d;
          });
          warDataReal.shift();
          donutchartouter(warDataReal);
          //donutchartouter(warData);
        }

d3.queue()
        .defer(d3.csv, "spending_final.csv")
        .await(callback2)
        function callback2 (error, data) {
          data.forEach(function(d) {
            d.name = d["Country "].replace(/\s+/g, '');
            d.region = d["Region"];
            var sum = 0;
            for (var i = 1990; i < 2017; i++) {
              var num = Number(d[i]);
              d.i = num;
              if (num != -1) sum += Math.floor(num);
              if (num > maxSpending) maxSpending = num;
              if (num < minSpending && num != -1) minSpending = num;
            }
            d.total = sum;
            if (sum > maxTotal) {
              maxTotal = sum;
              maxCountry = d.name;
            }
            spendingData[d["Country "].replace(/\s+/g, '')] = d;
          });
         // console.log(spendingData);
          //console.log(maxTotal);
          //console.log(maxCountry);
          donutchartinner(countrySet);
          drawLineGraph();
          drawHoriCharts();
        }

//var companySize=Math.random() * (50 - 30) + 30;
//var warSize= warDataReal.length;
//var warSize = Math.random() * (50 - 30) + 30;
//var companyData=[];
//var warData=[];

/*for(var i=0;i<companySize;i++){
  companyData.push({name: "Company"+ i, id: i, profit: Math.random() * (maxProfit - minProfit) + minProfit});
}

function getCompanies(int){
  var num=Math.random() * (10 - 3) + 3;
  var companies = []
  for(var i=0;i<num;i++){
    companies.push("Company"+Math.floor(Math.random() * (int)));

  }
  return companies;
}

//for testing purposes
for(var i=0;i<warSize;i++){
  warData.push({name: "War"+i, id: i, duration: Math.random() * (100 - 10) + 10, companies: getCompanies(companySize)});
}*/


//Creates a scatterplot within a circle. Takes as input an array of objects containing company name and the profit.  
function scatterplot(rawdata, start, end){

  //rawdata in cludes list of countries
  var data=[];

  for (var i = 0; i < rawdata.length; i++) {
    var country = rawdata[i];
    //console.log(spendingData[country]);
    var totalInterval = 0;
    for (var j = Number(start); j <= Number(end); j++) {
      if (Number(spendingData[country][j]) != -1)
        //console.log(Number(spendingData[country][j]));
        totalInterval += Number(spendingData[country][j]);
    }
    var color = colorToCountry.get(spendingData[country]["Region"]);
    data.push({country, totalInterval, color});
  }

  var padding=20;
  var scatterSVG = mainSVG.append("g")
    .attr("id", function(d) { return "scatterSVG"})
    .attr("height", widthScatter+padding).attr("width", heightScatter+padding)
    .attr("transform", "translate(" + (width/2 - widthScatter/2) + "," + (height/2 - heightScatter/2) + ")" );


  var averageSpending = (minSpending + maxSpending)/2;

  var totalSpending = 0;
  for(d in data){
    totalSpending+=data[d]["totalInterval"];
  }

  /*var rScale = d3.scaleLinear().domain([minProfit, maxProfit]).range([8, widthScatter/(2*Math.sqrt(totalProfit/averageProfit))]);*/

  var rScale = d3.scaleSqrt().domain([minSpending, totalSpending]).range([8, 70]);


  var numNodes = data.length;
  var nodes = d3.range(numNodes).map(function(d) {
    return {radius: rScale(data[d].totalInterval), color: data[d].color, name: data[d].country, total: data[d].totalInterval}
  });

  var boxForce = boundedBox()
    .bounds([[0, 0], [widthScatter, heightScatter]])
    .size(function (d) { return [d.size, d.size] })

  var boxForce2 = boundedBox()
    .bounds([[0, 0], [widthScatter*1.25, heightScatter*1.25]])
    .size(function (d) { return [d.size, d.size] })

  var simulation = d3.forceSimulation(nodes)
    .force('charge', d3.forceManyBody().strength(5))
    .force('center', d3.forceCenter(widthScatter / 2, heightScatter / 2))
    .force('collision', d3.forceCollide().radius(function(d) {
      return d.radius;
    }))
    .force('box', boxForce)
    .force('box', boxForce2)
    .on('tick', ticked);

  function ticked() {
    var u = scatterSVG
      .selectAll('circle')
      .data(nodes)
    u.enter()
      .append('circle')
      .attr('r', function(d) {
        return d.radius;
      })
      .attr('id', function(d){ return d.name})
      .style("stroke", function (d) {
        if (d.name == "UnitedStates") return "green";
      })
      .style("stroke-width",function (d) {
        if (d.name == "UnitedStates") return 3;
      })
      .style("fill", function (d) {
        return d.color;
            })
      .merge(u)
      .attr('cx', function(d) {
        return d.x;
      })
      .attr('cy', function(d) {
        return d.y;
      })
      .append('text')
      .text(function(d) {return "FUCK";})
      .attr('y', function(d){ return d.y;})
      .attr('x',function(d){return d.x;})
      .style("font-size", "10px");
      


    u.exit().remove()
  }

  

  for(var n in nodes){
    var d= nodes[n];
     var evt = new MouseEvent("mouseover");
     d3.select('#'+d.name).node().dispatchEvent(evt);    

  }

  return data;
}
  //Code for bounding box taken from https://bl.ocks.org/cmgiven/547658968d365bcc324f3e62e175709b
  function boundedBox() {
    var nodes, sizes
    var bounds
    var size = [0, 0]

    function force() {
        var node, size
        var xi, x0, x1, yi, y0, y1
        var i = -1
        while (++i < nodes.length) {
            node = nodes[i]
            size = sizes[i]
            xi = node.x + node.vx
            x0 = bounds[0][0] - xi
            x1 = bounds[1][0] - (xi + size[0])
            yi = node.y + node.vy
            y0 = bounds[0][1] - yi
            y1 = bounds[1][1] - (yi + size[1])
            if (x0 > 0 || x1 < 0) {
                node.x += node.vx
                node.vx = -node.vx
                if (node.vx < x0) { node.x += x0 - node.vx }
                if (node.vx > x1) { node.x += x1 - node.vx }
            }
            if (y0 > 0 || y1 < 0) {
                node.y += node.vy
                node.vy = -node.vy
                if (node.vy < y0) { node.vy += y0 - node.vy }
                if (node.vy > y1) { node.vy += y1 - node.vy }
            }
        }
    }
    force.initialize = function (_) {
        sizes = (nodes = _).map(size)
    }

    force.bounds = function (_) {
        return (arguments.length ? (bounds = _, force) : bounds)
    }

    force.size = function (_) {
        return (arguments.length
             ? (size = typeof _ === 'function' ? _ : constant(_), force)
             : size)
    }

    return force
}

//pie construction from https://bl.ocks.org/mbostock/3887193
function donutchartouter(data) {

var outerWidth = 650;
var outerHeight = 650;
var outerRadius = Math.min(outerWidth, outerHeight) / 2;

var arc = d3.arc()
.outerRadius(outerRadius - 10)
.innerRadius(outerRadius - 35)
.cornerRadius(2);

var pie = d3.pie()
.sort(null)
.value(function (d) {return d.duration})
.padAngle(.02);

var donutSVG = mainSVG.append('g')
.attr('height', height).attr('width', width);

var infodiv;
var isActive = false;
var previous;
var g = donutSVG.selectAll('.arc')
.data(pie(data))
.enter().append('g')
.attr('class', 'arc')
.attr("id", function(d) {return d.data.name })
.attr("transform", "translate(" + width/2 + "," + height/2 + ")" )
.on("mouseover", function(d) {
  console.log(d.data.name);
  console.log(d.data.Start);
  //var active = isActive ? false : true,
    //newOpacity = active ? 0.3 : 1;
  //console.log(g.select);
 // console.log(g.select('#'+d.data.name).selectAll("path").style("fill"));
  //g.selectAll("path").style("fill", function(d){d3.rgb(d3.select('#'+d.data.name).selectAll("path").style("fill")).darker(1)});
  
  //infodiv = displayInfoBox(d.data.name, d.data.desc);
  /*infodiv.transition()    
           .duration(200)    
           .style("visibility", "visible"); */

  d3.select(this).style("fill", d3.select(this).attr('stroke')).attr('opacity', 0.3);

  var newd = scatterplot(d.data.countries, d.data.Start, d.data.Finish);
  displayInfoBox(d.data, newd);
 

  /*for (var i in d.data.countries) {
   // console.log(d.data.countries[i]);
    var arc = d3.select('g#' + d.data.countries[i]);
    arc.style("fill", d3.select(this).attr('stroke')).attr('opacity', 0.3);
  }*/

  var select = d3.select(this);

  countrySet.forEach(function (f) {
    console.log(d.data.countries);
    if (!d.data.countries.includes(f)) {
      var arc = d3.select('g#' + f);
      arc.style("fill", select.attr('stroke')).attr('opacity', 0.3);
    }
  })
  /*var colors = [];
  for(var i in d.data.companies){
    var arc = d3.select('g#' + d.data.companies[i]);
    var currentcolor=arc.selectAll("path").style("fill");
    colors.push({name: d.data.companies[i], color: currentcolor});
    arc.style("fill", d3.select(this).attr('stroke')).attr('opacity', 0.3);
   
  }*/
})
.on("mouseout", function(d) {
  d3.select(this).style("fill", d3.select(this).attr('stroke')).attr('opacity', 1);
  var scatter= d3.select('#scatterSVG').remove();
  var select = d3.select(this);

  countrySet.forEach(function (f) {
    console.log(d.data.countries);
    if (!d.data.countries.includes(f)) {
      var arc = d3.select('g#' + f);
      arc.style("fill", select.attr('stroke')).attr('opacity', 1);
    }
  });
  /*for(var i in d.data.countries){
    var arc = d3.select('g#' + d.data.countries[i]);
    //var currentcolor=arc.selectAll("path").style("fill");
    arc.style("fill", d3.select(this).attr('stroke')).attr('opacity', 1);
  }*/
});

g.append('path')
.attr('d', arc)
.style('fill', '#cdcdcd');

var textArc = d3.arc()
.outerRadius(outerRadius + 5)
.innerRadius(outerRadius);

//rotated text from http://bl.ocks.org/vigorousnorth/7331bb51d4f0c2ae0314
g.append('text')
.text(function(d) {return d.data.name;})
.attr('dy', '0.25em')
.style("font-size", "10px")
.attr("text-anchor", function(d) {
  var midAngle = d.endAngle <= Math.PI ? d.startAngle/2 + d.endAngle/2 : d.startAngle/2  + d.endAngle/2;
  //console.log(midAngle);

  if (midAngle >= Math.PI) return "end";
  else if (d.data.name === "War on Terror") return "end";
  else return "start";})
.attr("transform", function(d) { 
      var midAngle = d.endAngle < Math.PI ? d.startAngle/2 + d.endAngle/2 : d.startAngle/2  + d.endAngle/2 + Math.PI ;
      return "translate(" + textArc.centroid(d)[0] + "," + textArc.centroid(d)[1] + ") rotate(-90) rotate(" + (midAngle * 180/Math.PI) + ")"; })
.style("fill", "#cdcdcd");

var circleArc = d3.arc()
.outerRadius(outerRadius - 50)
.innerRadius(outerRadius - 60);

/*g.append('circle')
.attr("cx", function(d) {return circleArc.centroid(d)[0];})
.attr("cy", function(d) {return circleArc.centroid(d)[1];})
.attr("r", 2)
.style("fill", "#cdcdcd");*/

}

function donutchartinner(data) {
var innerWidth = 400;
var innerHeight = 400;
var innerRadius = Math.min(innerWidth, innerHeight) / 2;

var arc = d3.arc()
.outerRadius(innerRadius - 20)
.innerRadius(innerRadius - 35)
.cornerRadius(2);

var spendingDataArray = [];
data.forEach(function(d) {
  //console.log(d);
  spendingDataArray.push({"country": d, "data": spendingData[d]});
});
console.log(spendingDataArray);
/*var spendingDataArray = Object.keys(data).map(function(key) {
  return {"country": key, "data": data[key]}
});*/

var pie = d3.pie()
.sort(null)
.value(10)
.padAngle(.02);

var innerSVG = mainSVG.append('g')
.attr('height', innerHeight).attr('width', innerWidth)
.attr("transform", "translate(" + (width/2 - innerWidth/2) + "," + (height/2 - innerHeight/2) + ")" );

var g  = innerSVG.selectAll('.arc')
.data(pie(spendingDataArray))
.enter().append('g')
.attr('class', 'arc')
.attr("transform", "translate(" + innerWidth/2 + "," + innerHeight/2 + ")" )
.attr("id", function(d) { return d.data.data.name; })
.on("mouseover", function(d) {
  console.log(d.data.data.name);
  console.log( this.getBoundingClientRect());
}) ;

g.append('path')
.attr('d', arc)
.style('fill', function(d){
  return colorToCountry.get(d.data.data.region);
  });

var circleArc = d3.arc()
.outerRadius(innerRadius + 5)
.innerRadius(innerRadius);

/*g.append('circle')
.attr("cx", function(d) {return circleArc.centroid(d)[0];})
.attr("cy", function(d) {return circleArc.centroid(d)[1];})
.attr("r", 2)
.style("fill", "#cdcdcd");*/

//rotated text from http://bl.ocks.org/vigorousnorth/7331bb51d4f0c2ae0314
g.append('text')
.text(function(d) {
  var countryName = d.data.data.name;
  if (countryName == "SaudiArabia") countryName = "Saudi Arabia";
    else if (countryName == "SouthKorea") countryName = "South Korea";
    else if (countryName == "SouthAfrica") countryName = "South Africa";
    else if (countryName == "UnitedStates") countryName = "United States";
  return countryName;})
.attr('dy', '0.25em')
.style("font-size", "10px")
.attr("text-anchor", function(d) {
  var midAngle = d.endAngle <= Math.PI ? d.startAngle/2 + d.endAngle/2 : d.startAngle/2  + d.endAngle/2;
 // console.log(midAngle);

  if (midAngle >= Math.PI) return "end";
  else return "start";})
.attr("transform", function(d) { 
      var midAngle = d.endAngle < Math.PI ? d.startAngle/2 + d.endAngle/2 : d.startAngle/2  + d.endAngle/2 + Math.PI ;
      return "translate(" + circleArc.centroid(d)[0] + "," + circleArc.centroid(d)[1] + ") rotate(-90) rotate(" + (midAngle * 180/Math.PI) + ")"; })
.style("fill", "#cdcdcd");

}

function displayInfoBox(data, cdata) {

  var warName= document.getElementById('name');
  var warDesc= document.getElementById('description');
  var list= document.getElementById('countrylist');
  list.innerHTML='';
  console.log(data);
  warName.innerHTML= data.name;
  warDesc.innerHTML= data.desc;

  for(var c in cdata){
    var country = cdata[c];
    var countryName = "";
    colorToCountry.get(spendingData[country.country]["Region"]);
    if (country.country == "SaudiArabia") countryName = "Saudi Arabia";
    else if (country.country == "SouthKorea") countryName = "South Korea";
    else if (country.country == "SouthAfrica") countryName = "South Africa";
    else if (country.country == "UnitedStates") countryName = "United States";
    else {
      countryName = country.country;
    }
    list.innerHTML+='<p>'+ countryName + " spent $"+ country.totalInterval + " million" +'</p>';
    
  }

}

function drawLineGraph() {

  var margin = {top: 20, right: 20, bottom: 30, left: 170},
    lineWidth = 960 - margin.left - margin.right,
    lineHeight = 500 - margin.top - margin.bottom;

  var svg = d3.select("#svglinegraph").append("svg")
    .attr("width", lineWidth + margin.left + margin.right)
    .attr("height", lineHeight + margin.top + margin.bottom)
    .append("g")
    .attr("transform",
          "translate(" + margin.left + "," + margin.top + ")");

  var scaleX = d3.scaleLinear().range([0,lineWidth]);
  var scaleY = d3.scaleLinear().range([lineHeight, 0]);

  scaleX.domain([1990,2016]);
  scaleY.domain([0, 800000]);

  svg.append("g")
      .attr("class", "axis")
      .attr("transform", "translate(0," + lineHeight + ")")
      .call(d3.axisBottom(scaleX).tickFormat(d3.format("d")));

    svg.append("g")
      .attr("class", "axis")
      .call(d3.axisLeft(scaleY));

    var yearCounter = 1990;

    var lineFunction = d3.line()
                       .x(function(d) { return scaleX(d.year);})
                       .y(function(d) { return scaleY(d.value); })
                       .curve(d3.curveLinear); 
    
    var tooltip = d3.select('#svglinegraph').append("div")
      .attr("class", "tooltip")
      .style("opacity", 0);

    countrySet.forEach(function(d) {
      var lineData =[];
      for (var i = 1990; i < 2017; i++) {
        lineData.push({"year": i, "value": spendingData[d][i]});
      }
      console.log(lineData);
        svg.append("path")
          .attr("id", "line" + d)
          .attr("d", lineFunction(lineData))
          .attr("stroke", colorToCountry.get(spendingData[d]["Region"]))
          .attr("stroke-width", 2)
          .attr("fill", "none")
          .on("mouseover", function() {
            console.log(d);
            d3.select(this).style("stroke-width", 5);
            tooltip.transition()
              .duration(200)
              .style("opacity", 0.9);
            tooltip.html(d)
              .style("left", (d3.event.pageX) + "px")   
              .style("top", (d3.event.pageY - 28) + "px");
          })
          .on("mouseout", function() {
            d3.select(this).style("stroke-width", 2);
            tooltip.transition()
              .duration(500)
              .style("opacity", 0);
          });
    });


  svg.append("text")
    .attr("text-anchor", "middle")
    .attr("transform", "translate(" + -50 + "," + (lineHeight/2) + ")rotate(-90)")
    //.attr("font-family", "'Ubuntu', sans-serif")
    .text("Domestic Military Spending")
    .style("fill", "white");

  svg.append("text")
    .attr("text-anchor", "middle")
    .attr("transform", "translate("+ (lineWidth/2) +","+(lineHeight + 30) + ")")
    //.attr("font-family", "'Ubuntu', sans-serif")
    .text("Year")
    .style("fill", "white");
}

//code inspiration for animations from http://duspviz.mit.edu/d3-workshop/transitions-animation/
function removeUS() {
  var margin = {top: 20, right: 20, bottom: 30, left: 170},
    lineWidth = 960 - margin.left - margin.right,
    lineHeight = 500 - margin.top - margin.bottom;

  var noUSSet = new Set(countrySet);
  noUSSet.delete("UnitedStates");

  var scaleX = d3.scaleLinear().range([0,lineWidth]);
  var scaleY = d3.scaleLinear().range([lineHeight, 0]);

  scaleX.domain([1990,2016]);
  scaleY.domain([0, 250000]);

  var svg = d3.select("#svglinegraph").transition();
  var lineFunction = d3.line()
                       .x(function(d) { return scaleX(d.year);})
                       .y(function(d) { return scaleY(d.value); })
                       .curve(d3.curveLinear); 

  svg.select(".yAxis")
    .duration(750)
    .call(d3.axisLeft(scaleY));

  svg.select("#lineUnitedStates")
   .duration(750)
   .attr("transform", "translate(0, -800)");
  
  noUSSet.forEach(function(d) {
    var lineData =[];
      for (var i = 1990; i < 2017; i++) {
        lineData.push({"year": i, "value": spendingData[d][i]});
      }
      console.log(lineData);
      svg.select("#line" + d)
          .duration(750)
          .attr("d", lineFunction(lineData));
    });
}

function reset() {
  var margin = {top: 20, right: 20, bottom: 30, left: 170},
    lineWidth = 960 - margin.left - margin.right,
    lineHeight = 500 - margin.top - margin.bottom;

  var scaleX = d3.scaleLinear().range([0,lineWidth]);
  var scaleY = d3.scaleLinear().range([lineHeight, 0]);

  scaleX.domain([1990,2016]);
  scaleY.domain([0, 800000]);

  var svg = d3.select("#svglinegraph").transition();
  var lineFunction = d3.line()
                       .x(function(d) { return scaleX(d.year);})
                       .y(function(d) { return scaleY(d.value); })
                       .curve(d3.curveLinear); 

  svg.select(".yAxis")
    .duration(750)
    .call(d3.axisLeft(scaleY));

  countrySet.forEach(function(d) {
    var lineData =[];
      for (var i = 1990; i < 2017; i++) {
        lineData.push({"year": i, "value": spendingData[d][i]});
      }
      console.log(d);
      svg.select("#line" + d)
          .duration(750)
          .attr("d", lineFunction(lineData))
          .attr("transform", "translate(0,0)");
    });
}

function filter(value) {
  console.log(value);
  var margin = {top: 20, right: 20, bottom: 30, left: 170},
    lineWidth = 960 - margin.left - margin.right,
    lineHeight = 500 - margin.top - margin.bottom;

  var scaleX = d3.scaleLinear().range([0,lineWidth]);
  var scaleY = d3.scaleLinear().range([lineHeight, 0]);

  scaleX.domain([1990,2016]);
  switch (value) {
    case "Africa":
      scaleY.domain([0, 9000]);
      break;
    case "Asia":
      scaleY.domain([0, 260000]);
      break;  
    case "Europe":
      scaleY.domain([0, 200000]);
      break;
    case "Americas":
      scaleY.domain([0, 800000]);
      break;
    case "Middle East":
      scaleY.domain([0, 100000]);
      break;
    case "Oceania":
      scaleY.domain([0, 180000]);
      break;          
  }


  var svg = d3.select("#svglinegraph").transition();
  var lineFunction = d3.line()
                       .x(function(d) { return scaleX(d.year);})
                       .y(function(d) { return scaleY(d.value); })
                       .curve(d3.curveLinear); 

  svg.select(".yAxis")
    .duration(750)
    .call(d3.axisLeft(scaleY));

  var nonRegionSet = new Set();
  var regionSet = new Set();

  countrySet.forEach(function(d) {
    console.log(d);
    if(spendingData[d].Region == value) {
      regionSet.add(d);
    } else {
      nonRegionSet.add(d);
    }
  });

  regionSet.forEach(function(d) {
    var lineData =[];

      for (var i = 1990; i < 2017; i++) {
        lineData.push({"year": i, "value": spendingData[d][i]});
      }
      console.log(d);
      svg.select("#line" + d)
          .duration(750)
          .attr("d", lineFunction(lineData))
          .attr("transform", "translate(0,0)");
    });

  nonRegionSet.forEach(function(d) {
    svg.select("#line" + d)
   .duration(750)
   .attr("transform", "translate(0, -800)");
  })
}

function drawHoriCharts() {
  var margin = {top: 20, right: 20, bottom: 30, left: 170},
    lineWidth = 700 - margin.left - margin.right,
    lineHeight = 400 - margin.top - margin.bottom;

  var topTenSet = [];
  var countrySetCopy = new Set(countrySet);
  
  for (var i = 0; i < 10; i++) {
    var maxCountry = "";
    var maxTotal = 0;
    countrySetCopy.forEach(function(d) {
      if (spendingData[d].total > maxTotal) {
        maxTotal = spendingData[d].total;
        maxCountry = d;
      }
    });
    //topTenSet.add(maxCountry);
    topTenSet.push({"name": maxCountry, "total": maxTotal});
    countrySetCopy.delete(maxCountry);
  }

  console.log(topTenSet);

  var xScale = d3.scaleLinear()
            .domain([0,topTenSet[0].total + 2000000])
            .range([0,lineWidth]);

  var yScale = d3.scaleLinear()
          .domain([0,topTenSet.length - 1])
          .range([0,lineHeight]);

  var svg = d3.select("#horizontalchart").append("svg")
          .attr("width", lineWidth + margin.left + margin.right)
          .attr("height", lineHeight + margin.top + margin.bottom)
          .append("g")
          .attr("transform",
                "translate(" + margin.left + "," + margin.top + ")");

  svg.append("g")
      .attr("transform", "translate(0," + Number(lineHeight + 14) + ")")
      .attr("class", "axis")
      .call(d3.axisBottom(xScale).tickFormat(d3.format("d")));

  svg.append("g")
    .attr("class", "axis")
    .call(d3.axisLeft(yScale).tickSize(2).tickFormat(function(d, i) {
      console.log(topTenSet[i].name);
        return topTenSet[i].name;
      }));

  var chart = svg.append('g')
    .attr('id', 'bars')
    .selectAll('rect')
    .data(topTenSet)
    .enter()
    .append('rect')
    .attr('height', 24)
    .attr('width', function(d){
      return xScale(d.total);
    })
    .attr('x', 0)
    .attr('y', function(d, i) {
      return yScale(i) - 12 ;
    })
    .style("fill", function(d) {
      return colorToCountry.get(spendingData[d.name]["Region"])
    });

  var text = svg.append('g')
    .attr('id', 'text')
    .selectAll('text')
    .data(topTenSet)
    .enter()
    .append('text')
    .style('font-size', 10)
    .style('fill', 'white')
    .text(function (d) {
      console.log(d);
      return d.total;
    })
    .attr('x', function(d) {
      return xScale(d.total) + 10;
    })
    .attr('y', function(d, i) {
      return yScale(i) ;
    });
}


</script>
</body>
</html>
